{{/* Collaborator Grid View - Circular/Rounded tiles with hover effects */}}
{{ $item := .item }}
{{ $index := .index }}
{{ $hasMeta := .hasMeta }}

{{ $link := $item.RelPermalink }}
{{ $target := "" }}
{{ $hasExternalLink := $item.Params.external_link }}
{{ if $hasExternalLink }}
  {{ $link = $item.Params.external_link }}
  {{ $target = "target=\"_blank\" rel=\"noopener\"" }}
{{ end }}

<div class="group relative flex flex-col items-center p-6 bg-white dark:bg-zinc-900 rounded-2xl shadow-md hover:shadow-xl transition-all duration-300 hover:-translate-y-1 border border-zinc-100 dark:border-zinc-800">
  
  <!-- Country Flag in top right corner -->
  {{ with $item.Params.country }}
  <div class="absolute top-3 right-3 text-2xl">
    {{ . }}
  </div>
  {{ end }}
  
  <!-- Circular Avatar Section -->
  <div class="relative mb-4">
    <div class="w-28 h-28 rounded-full overflow-hidden ring-4 ring-primary-200 dark:ring-primary-800 shadow-lg group-hover:ring-primary-400 dark:group-hover:ring-primary-600 transition-all duration-300">
      {{ $avatar := ($item.Resources.ByType "image").GetMatch "*avatar*" }}
      {{ if $avatar }}
        {{ $avatar_150 := $avatar.Process "Fill 150x150 Center webp" }}
        <a href="{{ $link }}" {{ $target | safeHTMLAttr }}>
          <img src="{{ $avatar_150.RelPermalink }}" 
               alt="{{ $item.Title }} avatar"
               class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300"
               loading="lazy" 
               decoding="async">
        </a>
      {{ else }}
        <!-- Default avatar with initials -->
        <a href="{{ $link }}" {{ $target | safeHTMLAttr }} class="block w-full h-full">
          <div class="w-full h-full bg-gradient-to-br from-primary-400 to-primary-600 dark:from-primary-600 dark:to-primary-800 flex items-center justify-center group-hover:from-primary-500 group-hover:to-primary-700 transition-all duration-300">
            {{ $name := $item.Title }}
            {{ $initials := "" }}
            {{ $parts := split $name " " }}
            {{ range first 2 $parts }}
              {{ $initials = printf "%s%s" $initials (substr . 0 1) }}
            {{ end }}
            <span class="text-3xl font-bold text-white">{{ upper $initials }}</span>
          </div>
        </a>
      {{ end }}
    </div>
  </div>

  <!-- Name and Role -->
  <div class="text-center space-y-2 flex-grow">
    <h3 class="text-lg font-bold text-zinc-900 dark:text-zinc-100 group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors duration-200">
      <a href="{{ $link }}" {{ $target | safeHTMLAttr }} class="hover:underline">
        {{ $item.Title }}
      </a>
    </h3>
    
    {{ with $item.Params.role }}
    <p class="text-sm font-medium text-primary-600 dark:text-primary-400">
      {{ . }}
    </p>
    {{ end }}
    
    {{ with $item.Params.organization }}
    <p class="text-sm text-zinc-600 dark:text-zinc-400 leading-snug">
      {{ . }}
    </p>
    {{ end }}
  </div>

  <!-- Summary/Bio -->
  {{ with $item.Params.summary }}
  <p class="mt-4 text-sm text-zinc-500 dark:text-zinc-500 text-center line-clamp-2">
    {{ . }}
  </p>
  {{ end }}

  <!-- Links to Projects/Publications -->
  {{ with $item.Params.links }}
  <div class="mt-4 pt-4 border-t border-zinc-100 dark:border-zinc-800 w-full">
    <div class="flex flex-wrap justify-center gap-2">
      {{ range . }}
      {{ $linkItem := . }}
      {{ with .url }}
      <a href="{{ . | safeURL }}" 
         class="inline-flex items-center gap-1 px-3 py-1.5 rounded-full text-xs font-medium bg-primary-100 text-primary-700 dark:bg-primary-900/40 dark:text-primary-300 hover:bg-primary-200 dark:hover:bg-primary-900/60 transition-colors duration-200">
        {{ with $linkItem.icon }}
          {{ partial "functions/get_icon" (dict "name" . "attributes" "class=\"w-3 h-3\"") }}
        {{ end }}
        {{ $linkItem.name }}
      </a>
      {{ end }}
      {{ end }}
    </div>
  </div>
  {{ end }}

  <!-- Tags -->
  {{ with $item.Params.tags }}
  <div class="mt-3 flex flex-wrap justify-center gap-1">
    {{ range first 3 . }}
    <span class="px-2 py-0.5 text-[10px] font-medium rounded-full bg-zinc-100 text-zinc-600 dark:bg-zinc-800 dark:text-zinc-400">
      {{ . }}
    </span>
    {{ end }}
  </div>
  {{ end }}

</div>
